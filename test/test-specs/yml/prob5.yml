name: prob1

steps:
  - title:  Setup, create test directory yyyy-mm-dd
    action: Complete the setup procedures first, include new test folder with today's date.

  - title:  Clone truchas-extensions repository
    action: |
      Clone the truchas-extensions repository, either
      <a class="literal-link" target="_blank" href="https://gitlab.kitware.com/cmb/plugins/truchas-extensions.git"></a>
      or <a class="literal-link" target="_blank" href="git@gitlab.kitware.com:cmb/plugins/truchas-extensions.git"></a>.

  - title:  New project
    action: Select Project => New Project...
    expect: modelbuilder to open a directory browser dialog

  - title:  New project directory <tt>yyyy-mm-dd/prob5b</tt>
    action: In that dialog, navigate to the test directory you created in the setup procedure and create a subdirectory <tt>yyyy-mm-dd/prob5b</tt>. Select the new subdirectory and click the `OK`.
    expect: modelbuilder to display a "Specify New Project" dialog with the "Workspace Directory" and "Name (Subdirectory)" fields set.

  - title:  Simulation template "Truchas.sbt"
    action: Set the "Simulation Template File" to the Truchas template that is in the truchas-extensions repository at <tt>simulation-workflows/Truchas.sbt</tt>.

  - title:  Geometry model "mesh2.gen"
    action: Set the "Geometry File" to <tt>truchas-extensions/test/cmb-target-problems/meshes/mesh2.gen</tt>.

  - title:  Apply
    action: Click the "Apply" button.
    expect: modelbuilder to close the dialog, then display the model geometry in the 3D view and update the Attribute Editor to display a "Modules" tab. On some systems, the model is not immediately displayed, but instead it appears when the "Resources" tab is selected. If that occurs, add a comment to the GitLab issue. Verify that there are two items listed in the "Resources" panel, labeled <tt>sbi.default</tt> and <tt>mesh2</tt>.

  - title: Surface Entities
    action: Above in the tool bars you should see three buttons with eyes, select the one that says "Show only surface entities"
    expect: The color of the model to change to darker colors.


    # Play or record test script
  - begin:  record/play
    title:  Begin record/play prob5a-1.xml
    action: |
      <li>Select whether to record or play the test. In general, you should select PLAY if the xml file is available.</li>
      <li>If you select PLAY, use the "Tools" => "Play Test..." menu item and navigate to the "prob5a-1.xml" file.</li>
      <li>If you select RECORD, use the "Tools" => "Record Test..." menu and specify "prob5a-1.xml" as the file.</li>

  - title: Select Modules
    action: |
      In the "Select Modules" section,
      <li>In the dropdown control select "Truchas".</li>
      <li>Then select "Heat Transfer", "Fluid Flow", "Viscous Flow", "Include Void Material".</li>
    expect: Model builder to open a several modules in the "Analysis" tab

  - title: Heat Transfer Mesh
    action: In the "Heat Transfer Mesh" section, click the "Coordinate Scale Factor" checkbox and enter 0.001 in the field to the right.

  - title: Numerics
    action: |
      In the "Analysis" tab under the "Numeric" section set:
      <ol>
        <li>Set "Dt_Init" to 0.01</li>
        <li>Set "Dt_Grow" to 1.05</li>
        <li>Set "Dt_Max" to 0.002</li>
        <li>Set "Dt_Min" to 1.0e-7</li>
      </ol>

  - title: Materials - graphite
    action: |
      In the "Materials" => "Specification" tab
      <ol>
        <li>Click "New" to create attribute and set its name to "graphite".</li>
        <li>Set "Density (rho)"" to 1750.</li>
        <li>Set "Enthalpy" to "Specific Heat"</li>
        <li>Set "Specific Heat (Cp)" to 1500.</li>
        <li>Set "Conductivity" to 100.</li>
      </ol>

    # skip:
    # <li>Click the "f(x)" tool & expect a dropdown box (Click dropdown and select create if needed)</li>
    #   In the dialog popup
    #   <ol>
    #     <li>Set the function type to "polynomial"</li>
    #     <li>In the first row add a coefficient of 240.6 and an exponent of 0</li>
    #     <li>Add a new row and enter values 2.50167 and 1</li>
    #     <li>Add a new row and enter values -1.1231e-3 and 2</li>
    #     <li>Add a new row and enter values 1.7e-7 and 3</li>
    #     <li>Press "OK"</li>
    #   </ol>

  - title: Materials - uranium
    action: |
      In the "Materials" => "Specification" tab,
      <ol>
        <li>click "New" to create second attribute, set its name to "U"</li>
        <li>Set "Density" to 17500.</li>
        <li>Set "Enthalpy" to "Specific Heat" and set "Specific Heat (Cp)" to 160.9</li>
        <li>Set "Conductivity" to 46.05</li>
      </ol>

      Click the "Add Phase" button. In response, modelbuilder displays an "advanced" view with 4 collapsible sections.
      <br />
      In the "Common Material Properties" section, uncheck the "Enthalpy" checkbox.
      <br />
      In the "Phase 1":" Phase 1" section
      <ol>
        <li>Change the "Name" field from "Phase 1" to "U-gamma".</li>
        <li>Set "Enthalpy" to "Specific Heat". The "Specific Heat (Cp)" should already be set to 160.9</li>
        <li>Collapse the "Phase 1" section</li>
      </ol>

      In the "Phase Change" section
      <ol>
        <li>Set "Latent Heat (Lf)" to 35794</li>
        <li>Set "Low Transition Temperature (Ts)" to 1396</li>
        <li>Set "High Transition Temperature" to 1416</li>
        <li>Collapse the "Phase Change" section</li>
      </ol>

      In the "Phase 2":"" section
      <ol>
        <li>Set the "Name" field to "U-liquid".</li>
        <li>Set "Enthalpy" to "Specific Heat", and set "Specific Heat (Cp)" to 201.3</li>
        <li>Check the "Fluid" checkbox.</li>
        <li>Set "Viscosity (nu)" to 0.005</li>
      </ol>


  - title:  Save Project
    action: Select the "Project" => "Save Project" menu item.


  - title: Modules -> Fluid Flow -> Boundary Conditions
    action: Todo

  - title: Modules => Fluid Flow => Solver
    action: Todo


  - title: Modules - Heat Transfer - Boundary Conditions - Boundary
    action: |
      Navigate to Modules => Heat Transfer => Boundary Conditions => Boundary
      <ol>
        <li>Select "Flux" from the dropdown menu and click "New"; Set "Heat Flux" to 0; Assign to "side set 1 - symmetry".</li>
        <li>Select "HTC" and click "New"; set "Heat Transfer Coefficient" to 50; set "Ambient Temperature" to 300; Assign to "side set 2"</li>
        <li>Select "Radiation" and click "New"; set "Emissivity" to 0.75; set "Ambient Temperature" to 300; assign to side sets 20, 21, 22</li>
        <li>Select "Flux" and click "New"; set "Heat Flux" to 0; assign to side sets 10, 11, 23</li>
        <li>Select "Flux" and click "New"; set "Heat Flux" to 0; assign to side set 6</li>
      </ol>

  - title: Modules - Heat Transfer - Boundary Conditions - Interface
    action: |
      Navigate to Modules => Heat Transfer => Boundary Conditions => Boundary
      <ol>
        <li>HTC -> New => coef 500, side set 30</li>
        <li>Gap radiation => New => emiss 0.75, side set 40</li>
        <li>HTC => New => coef 500, side sets 41 42</li>
        <li>HTC => New coef 200, side sets 50, 51</li>
        <li>HTC => New => coef 0, side set 24</li>
      </ol>

  - title: Modules - Heat Transfer - Solver
    action: |
      <li>Set "Relative residual tolerance" to 1.0e-5</li>
      <li>Set "Max NLK iterations" " to 1750.</li>

  - title:  Save Project
    action: Select the "Project" => "Save Project" menu item.

  - title: Bodies
    action: |
      Navigate to Bodies => Body Assignment tab
      <ol>
        <li>Click New to create Body attribute</li>
        <li>Set "Material Type" (drop down) to "Real"</li>
        <li>Set "Material" (dropdown) to "graphite"</li>
        <li>Set "Initial Temperature" to 1500</li>
        <li>Assign to element blocks 2, 3, 4, 5</li>
      </ol>

      <ol>
        <li>Click New to create a second Body attribute</li>
        <li>Set "Material Type" to "Void"</li>
        <li>Assign to element block 1</li>
      </ol>

    # defer:
    #   In the dialog popup
    #   <ol>
    #     <li>Set the function type to "polynomial"</li>
    #     <li>In the first row add a coefficient of 1500 and an exponent of 0, 0, 0</li>
    #     <li>Add a new row and enter values -1000 and 2, 2, 0</li>
    #     <li>Add a new row and enter values 100 and 0, 0, 1</li>
    #     <li>Press "Okay"</li>
    #   </ol>


  - title: Outputs
    action: |
      In the "Outputs" tab
        <ol>
          <li>Set "End Time" to 2.0</li>
          <li>Set "Initial Output Delta-Time" to 0.2</li>
        </ol>

  - title:  Save Project
    action: Select the "Project" => "Save Project" menu item.

  - end:    record/play
    title:  Finish record/play
    action: If you are recording the test, click the "Stop Recording" button to save the xml script.
    # End record/play
